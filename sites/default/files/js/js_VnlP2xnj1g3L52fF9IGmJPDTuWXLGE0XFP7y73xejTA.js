Drupal.locale = { 'pluralFormula': function ($n) { return Number(($n!=1)); }, 'strings': {"":{"Disabled":"\u05de\u05d5\u05e9\u05d1\u05ea","Enabled":"\u05de\u05d5\u05e4\u05e2\u05dc","Not published":"\u05d8\u05e8\u05dd \u05e4\u05d5\u05e8\u05e1\u05dd","Edit":"\u05e2\u05e8\u05d5\u05da","An AJAX HTTP error occurred.":"\u05ea\u05e7\u05dc\u05ea AJAX HTTP \u05e7\u05e8\u05ea\u05d4.","HTTP Result Code: !status":"\u05e7\u05d5\u05d3 \u05ea\u05d5\u05e6\u05d0\u05ea HTTP: !status","An AJAX HTTP request terminated abnormally.":"\u05d1\u05e7\u05e9\u05ea AJAX HTTP \u05d4\u05d5\u05e4\u05e1\u05e7\u05d4 \u05d1\u05d8\u05e8\u05dd \u05e2\u05ea.","Debugging information follows.":"\u05de\u05d9\u05d3\u05e2 \u05dc\u05e0\u05d9\u05e4\u05d5\u05d9 \u05e9\u05d2\u05d9\u05d0\u05d5\u05ea \u05de\u05d5\u05e6\u05d2 \u05dc\u05d4\u05dc\u05df.","Path: !uri":"\u05e0\u05ea\u05d9\u05d1: !uri","StatusText: !statusText":"\u05d8\u05e7\u05e1\u05d8 \u05e1\u05d8\u05d8\u05d5\u05e1: !statusText","ResponseText: !responseText":"\u05d8\u05e7\u05e1\u05d8 \u05ea\u05d2\u05d5\u05d1\u05d4: !responseText","ReadyState: !readyState":"\u05de\u05e6\u05d1 \u05de\u05d5\u05db\u05e0\u05d5\u05ea: !readyState","Please wait...":"\u05d4\u05de\u05ea\u05df \u05d1\u05d1\u05e7\u05e9\u05d4...","Autocomplete popup":"\u05d7\u05dc\u05d5\u05df \u05d4\u05e9\u05dc\u05de\u05d4 \u05d0\u05d5\u05d8\u05d5\u05de\u05d8\u05d9\u05ea \u05e7\u05d5\u05e4\u05e5","Searching for matches...":"\u05de\u05d7\u05e4\u05e9 \u05e2\u05d1\u05d5\u05e8 \u05ea\u05d0\u05d9\u05de\u05d5\u05d9\u05d5\u05ea...","Configure":"\u05d4\u05d2\u05d3\u05e8","(active tab)":"(\u05dc\u05e9\u05d5\u05e0\u05d9\u05ea \u05e4\u05e2\u05d9\u05dc\u05d4)","Not restricted":"\u05dc\u05d0 \u05de\u05d5\u05d2\u05d1\u05dc","Restricted to certain pages":"\u05de\u05d5\u05d2\u05d1\u05dc \u05dc\u05d3\u05e4\u05d9\u05dd \u05de\u05e1\u05d5\u05d9\u05d9\u05de\u05d9\u05dd","Not customizable":"\u05d0\u05d9\u05e0\u05d5 \u05e0\u05d9\u05ea\u05df \u05dc\u05d4\u05ea\u05d0\u05de\u05d4 \u05d0\u05d9\u05e9\u05d9\u05ea","The changes to these blocks will not be saved until the \u003Cem\u003ESave blocks\u003C\/em\u003E button is clicked.":"\u05d4\u05e9\u05d9\u05e0\u05d5\u05d9\u05d9\u05dd \u05dc\u05d1\u05dc\u05d5\u05e7\u05d9\u05dd \u05d0\u05dc\u05d5 \u05dc\u05d0 \u05d9\u05e9\u05de\u05e8\u05d5 \u05e2\u05d3 \u05dc\u05dc\u05d7\u05d9\u05e6\u05d4 \u05e2\u05dc \u05db\u05e4\u05ea\u05d5\u05e8 \u003Cem\u003E\u05e9\u05de\u05d5\u05e8 \u05d1\u05dc\u05d5\u05e7\u05d9\u05dd\u003C\/em\u003E.","The block cannot be placed in this region.":"\u05dc\u05d0 \u05e0\u05d9\u05ea\u05df \u05dc\u05de\u05e7\u05dd \u05d0\u05ea \u05d4\u05ea\u05d9\u05d1\u05d4 \u05d1\u05d0\u05d9\u05d6\u05d5\u05e8 \u05d6\u05d4","Re-order rows by numerical weight instead of dragging.":"\u05e1\u05d3\u05e8 \u05de\u05d7\u05d3\u05e9 \u05e9\u05d5\u05e8\u05d5\u05ea \u05e2\u05e4\u0022\u05d9 \u05d7\u05e9\u05d9\u05d1\u05d5\u05ea \u05de\u05e1\u05e4\u05e8\u05d9\u05ea \u05d1\u05de\u05e7\u05d5\u05dd \u05d2\u05e8\u05d9\u05e8\u05d4.","Show row weights":"\u05d4\u05e6\u05d2 \u05de\u05e9\u05e7\u05dc\u05d9 \u05e9\u05d5\u05e8\u05d5\u05ea","Hide row weights":"\u05d4\u05e1\u05ea\u05e8 \u05de\u05e9\u05e7\u05dc\u05d9 \u05e9\u05d5\u05e8\u05d5\u05ea","Drag to re-order":"\u05d2\u05e8\u05d5\u05e8 \u05dc\u05e1\u05d9\u05d3\u05d5\u05e8","Changes made in this table will not be saved until the form is submitted.":"\u05e9\u05d9\u05e0\u05d5\u05d9\u05d9\u05dd \u05d1\u05d8\u05d1\u05dc\u05d4 \u05d6\u05d5 \u05dc\u05d0 \u05d9\u05e9\u05de\u05e8\u05d5 \u05e2\u05d3 \u05dc\u05e9\u05dc\u05d9\u05d7\u05ea \u05d4\u05d8\u05d5\u05e4\u05e1.","Hide":"\u05d4\u05e1\u05ea\u05e8\u05d4","Show":"\u05d4\u05e6\u05d2","Mon":"\u05d1\u0027","Monday":"\u05e9\u05e0\u05d9","Add":"\u05d4\u05d5\u05e1\u05e3","Apply (all displays)":"\u05d4\u05d7\u05dc (\u05db\u05dc \u05d4\u05ea\u05e6\u05d5\u05d2\u05d5\u05ea)","Apply (this display)":"\u05d4\u05d7\u05dc (\u05ea\u05e6\u05d5\u05d2\u05d4 \u05d6\u05d5)","Select all rows in this table":"\u05d1\u05d7\u05e8 \u05d0\u05ea \u05db\u05dc \u05d4\u05e9\u05d5\u05e8\u05d5\u05ea \u05d1\u05d8\u05d1\u05dc\u05d4","Deselect all rows in this table":"\u05d1\u05d8\u05dc \u05d1\u05d7\u05d9\u05e8\u05ea \u05db\u05dc \u05d4\u05e9\u05d5\u05e8\u05d5\u05ea \u05d1\u05d8\u05d1\u05dc\u05d4","Edit summary":"\u05e2\u05e8\u05d9\u05db\u05ea \u05ea\u05e7\u05e6\u05d9\u05e8","Not in menu":"\u05dc\u05d0 \u05d1\u05ea\u05e4\u05e8\u05d9\u05d8","No revision":"\u05d0\u05d9\u05df \u05d2\u05d9\u05e8\u05e1\u05d4","By @name on @date":"\u05e2\u0022\u05d9 @name \u05d1- @date","By @name":"\u05e2\u0022\u05d9 @name","No alias":"\u05dc\u05d0 \u05d4\u05d5\u05d2\u05d3\u05e8 \u05de\u05d9\u05e7\u05d5\u05dd \u05d7\u05d9\u05dc\u05d5\u05e4\u05d9","Available tokens":"\u05d0\u05e1\u05d9\u05de\u05d5\u05e0\u05d9\u05dd \u05d6\u05de\u05d9\u05e0\u05d9\u05dd","Requires a title":"\u05d3\u05e8\u05d5\u05e9\u05d4 \u05db\u05d5\u05ea\u05e8\u05ea","Don\u0027t display post information":"\u05dc\u05d0 \u05dc\u05d4\u05e6\u05d9\u05d2 \u05de\u05d9\u05d3\u05e2 \u05e2\u05dc \u05d4\u05e4\u05d5\u05e1\u05d8","Thu":"\u05d4\u0027","Thursday":"\u05d7\u05de\u05d9\u05e9\u05d9","Fri":"\u05d5\u0027","Friday":"\u05e9\u05d9\u05e9\u05d9","Tue":"\u05d2\u0027","Sat":"\u05e9\u0027","Tuesday":"\u05e9\u05dc\u05d9\u05e9\u05d9","Wed":"\u05d3\u0027","Wednesday":"\u05e8\u05d1\u05d9\u05e2\u05d9","Next":"\u05d4\u05d1\u05d0","Saturday":"\u05e9\u05d1\u05ea","Sun":"\u05d0\u0027","Sunday":"\u05e8\u05d0\u05e9\u05d5\u05df","January":"\u05d9\u05e0\u05d5\u05d0\u05e8","February":"\u05e4\u05d1\u05e8\u05d5\u05d0\u05e8","March":"\u05de\u05e8\u05e5","April":"\u05d0\u05e4\u05e8\u05d9\u05dc","May":"\u05de\u05d0\u05d9","June":"\u05d9\u05d5\u05e0\u05d9","July":"\u05d9\u05d5\u05dc\u05d9","August":"\u05d0\u05d5\u05d2\u05d5\u05e1\u05d8","September":"\u05e1\u05e4\u05d8\u05de\u05d1\u05e8","October":"\u05d0\u05d5\u05e7\u05d8\u05d5\u05d1\u05e8","November":"\u05e0\u05d5\u05d1\u05de\u05d1\u05e8","December":"\u05d3\u05e6\u05de\u05d1\u05e8","Done":"\u05d1\u05d5\u05e6\u05e2","Prev":"\u05e7\u05d5\u05d3\u05dd","Today":"\u05d4\u05d9\u05d5\u05dd","Jan":"\u05d9\u05e0\u05d5\u0027","Feb":"\u05e4\u05d1\u05e8\u0027","Mar":"\u05de\u05e8\u05e5","Apr":"\u05d0\u05e4\u05e8\u0027","Jun":"\u05d9\u05d5\u05e0\u05d9","Jul":"\u05d9\u05d5\u05dc\u05d9","Aug":"\u05d0\u05d5\u05d2\u0027","Sep":"\u05e1\u05e4\u05d8\u0027","Oct":"\u05d0\u05d5\u05e7\u0027","Nov":"\u05e0\u05d5\u05d1\u0027","Dec":"\u05d3\u05e6\u05de\u0027","Resume":"\u05d7\u05d9\u05d3\u05d5\u05e9"}} };;
(function ($) {
  Drupal.viewsSlideshow = Drupal.viewsSlideshow || {};

  /**
   * Views Slideshow Controls
   */
  Drupal.viewsSlideshowControls = Drupal.viewsSlideshowControls || {};

  /**
   * Implement the play hook for controls.
   */
  Drupal.viewsSlideshowControls.play = function (options) {
    // Route the control call to the correct control type.
    // Need to use try catch so we don't have to check to make sure every part
    // of the object is defined.
    try {
      if (typeof Drupal.settings.viewsSlideshowControls[options.slideshowID].top.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].top.type].play == 'function') {
        Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].top.type].play(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }

    try {
      if (typeof Drupal.settings.viewsSlideshowControls[options.slideshowID].bottom.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].bottom.type].play == 'function') {
        Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].bottom.type].play(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }
  };

  /**
   * Implement the pause hook for controls.
   */
  Drupal.viewsSlideshowControls.pause = function (options) {
    // Route the control call to the correct control type.
    // Need to use try catch so we don't have to check to make sure every part
    // of the object is defined.
    try {
      if (typeof Drupal.settings.viewsSlideshowControls[options.slideshowID].top.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].top.type].pause == 'function') {
        Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].top.type].pause(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }

    try {
      if (typeof Drupal.settings.viewsSlideshowControls[options.slideshowID].bottom.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].bottom.type].pause == 'function') {
        Drupal[Drupal.settings.viewsSlideshowControls[options.slideshowID].bottom.type].pause(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }
  };


  /**
   * Views Slideshow Text Controls
   */

  // Add views slieshow api calls for views slideshow text controls.
  Drupal.behaviors.viewsSlideshowControlsText = {
    attach: function (context) {

      // Process previous link
      $('.views_slideshow_controls_text_previous:not(.views-slideshow-controls-text-previous-processed)', context).addClass('views-slideshow-controls-text-previous-processed').each(function() {
        var uniqueID = $(this).attr('id').replace('views_slideshow_controls_text_previous_', '');
        $(this).click(function() {
          Drupal.viewsSlideshow.action({ "action": 'previousSlide', "slideshowID": uniqueID });
          return false;
        });
      });

      // Process next link
      $('.views_slideshow_controls_text_next:not(.views-slideshow-controls-text-next-processed)', context).addClass('views-slideshow-controls-text-next-processed').each(function() {
        var uniqueID = $(this).attr('id').replace('views_slideshow_controls_text_next_', '');
        $(this).click(function() {
          Drupal.viewsSlideshow.action({ "action": 'nextSlide', "slideshowID": uniqueID });
          return false;
        });
      });

      // Process pause link
      $('.views_slideshow_controls_text_pause:not(.views-slideshow-controls-text-pause-processed)', context).addClass('views-slideshow-controls-text-pause-processed').each(function() {
        var uniqueID = $(this).attr('id').replace('views_slideshow_controls_text_pause_', '');
        $(this).click(function() {
          if (Drupal.settings.viewsSlideshow[uniqueID].paused) {
            Drupal.viewsSlideshow.action({ "action": 'play', "slideshowID": uniqueID, "force": true });
          }
          else {
            Drupal.viewsSlideshow.action({ "action": 'pause', "slideshowID": uniqueID, "force": true });
          }
          return false;
        });
      });
    }
  };

  Drupal.viewsSlideshowControlsText = Drupal.viewsSlideshowControlsText || {};

  /**
   * Implement the pause hook for text controls.
   */
  Drupal.viewsSlideshowControlsText.pause = function (options) {
    var pauseText = Drupal.theme.prototype['viewsSlideshowControlsPause'] ? Drupal.theme('viewsSlideshowControlsPause') : '';
    $('#views_slideshow_controls_text_pause_' + options.slideshowID + ' a').text(pauseText);
  };

  /**
   * Implement the play hook for text controls.
   */
  Drupal.viewsSlideshowControlsText.play = function (options) {
    var playText = Drupal.theme.prototype['viewsSlideshowControlsPlay'] ? Drupal.theme('viewsSlideshowControlsPlay') : '';
    $('#views_slideshow_controls_text_pause_' + options.slideshowID + ' a').text(playText);
  };

  // Theme the resume control.
  Drupal.theme.prototype.viewsSlideshowControlsPause = function () {
    return Drupal.t('Resume');
  };

  // Theme the pause control.
  Drupal.theme.prototype.viewsSlideshowControlsPlay = function () {
    return Drupal.t('Pause');
  };

  /**
   * Views Slideshow Pager
   */
  Drupal.viewsSlideshowPager = Drupal.viewsSlideshowPager || {};

  /**
   * Implement the transitionBegin hook for pagers.
   */
  Drupal.viewsSlideshowPager.transitionBegin = function (options) {
    // Route the pager call to the correct pager type.
    // Need to use try catch so we don't have to check to make sure every part
    // of the object is defined.
    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].transitionBegin == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].transitionBegin(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }

    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].transitionBegin == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].transitionBegin(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }
  };

  /**
   * Implement the goToSlide hook for pagers.
   */
  Drupal.viewsSlideshowPager.goToSlide = function (options) {
    // Route the pager call to the correct pager type.
    // Need to use try catch so we don't have to check to make sure every part
    // of the object is defined.
    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].goToSlide == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].goToSlide(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }

    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].goToSlide == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].goToSlide(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }
  };

  /**
   * Implement the previousSlide hook for pagers.
   */
  Drupal.viewsSlideshowPager.previousSlide = function (options) {
    // Route the pager call to the correct pager type.
    // Need to use try catch so we don't have to check to make sure every part
    // of the object is defined.
    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].previousSlide == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].previousSlide(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }

    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].previousSlide == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].previousSlide(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }
  };

  /**
   * Implement the nextSlide hook for pagers.
   */
  Drupal.viewsSlideshowPager.nextSlide = function (options) {
    // Route the pager call to the correct pager type.
    // Need to use try catch so we don't have to check to make sure every part
    // of the object is defined.
    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].nextSlide == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].top.type].nextSlide(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }

    try {
      if (typeof Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type != "undefined" && typeof Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].nextSlide == 'function') {
        Drupal[Drupal.settings.viewsSlideshowPager[options.slideshowID].bottom.type].nextSlide(options);
      }
    }
    catch(err) {
      // Don't need to do anything on error.
    }
  };


  /**
   * Views Slideshow Pager Fields
   */

  // Add views slieshow api calls for views slideshow pager fields.
  Drupal.behaviors.viewsSlideshowPagerFields = {
    attach: function (context) {
      // Process pause on hover.
      $('.views_slideshow_pager_field:not(.views-slideshow-pager-field-processed)', context).addClass('views-slideshow-pager-field-processed').each(function() {
        // Parse out the location and unique id from the full id.
        var pagerInfo = $(this).attr('id').split('_');
        var location = pagerInfo[2];
        pagerInfo.splice(0, 3);
        var uniqueID = pagerInfo.join('_');

        // Add the activate and pause on pager hover event to each pager item.
        if (Drupal.settings.viewsSlideshowPagerFields[uniqueID][location].activatePauseOnHover) {
          $(this).children().each(function(index, pagerItem) {
            var mouseIn = function() {
              Drupal.viewsSlideshow.action({ "action": 'goToSlide', "slideshowID": uniqueID, "slideNum": index });
              Drupal.viewsSlideshow.action({ "action": 'pause', "slideshowID": uniqueID });
            }
            
            var mouseOut = function() {
              Drupal.viewsSlideshow.action({ "action": 'play', "slideshowID": uniqueID });
            }
          
            if (jQuery.fn.hoverIntent) {
              $(pagerItem).hoverIntent(mouseIn, mouseOut);
            }
            else {
              $(pagerItem).hover(mouseIn, mouseOut);
            }
            
          });
        }
        else {
          $(this).children().each(function(index, pagerItem) {
            $(pagerItem).click(function() {
              Drupal.viewsSlideshow.action({ "action": 'goToSlide', "slideshowID": uniqueID, "slideNum": index });
            });
          });
        }
      });
    }
  };

  Drupal.viewsSlideshowPagerFields = Drupal.viewsSlideshowPagerFields || {};

  /**
   * Implement the transitionBegin hook for pager fields pager.
   */
  Drupal.viewsSlideshowPagerFields.transitionBegin = function (options) {
    for (pagerLocation in Drupal.settings.viewsSlideshowPager[options.slideshowID]) {
      // Remove active class from pagers
      $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"]').removeClass('active');

      // Add active class to active pager.
      $('#views_slideshow_pager_field_item_'+ pagerLocation + '_' + options.slideshowID + '_' + options.slideNum).addClass('active');
    }

  };

  /**
   * Implement the goToSlide hook for pager fields pager.
   */
  Drupal.viewsSlideshowPagerFields.goToSlide = function (options) {
    for (pagerLocation in Drupal.settings.viewsSlideshowPager[options.slideshowID]) {
      // Remove active class from pagers
      $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"]').removeClass('active');

      // Add active class to active pager.
      $('#views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '_' + options.slideNum).addClass('active');
    }
  };

  /**
   * Implement the previousSlide hook for pager fields pager.
   */
  Drupal.viewsSlideshowPagerFields.previousSlide = function (options) {
    for (pagerLocation in Drupal.settings.viewsSlideshowPager[options.slideshowID]) {
      // Get the current active pager.
      var pagerNum = $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"].active').attr('id').replace('views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '_', '');

      // If we are on the first pager then activate the last pager.
      // Otherwise activate the previous pager.
      if (pagerNum == 0) {
        pagerNum = $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"]').length() - 1;
      }
      else {
        pagerNum--;
      }

      // Remove active class from pagers
      $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"]').removeClass('active');

      // Add active class to active pager.
      $('#views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '_' + pagerNum).addClass('active');
    }
  };

  /**
   * Implement the nextSlide hook for pager fields pager.
   */
  Drupal.viewsSlideshowPagerFields.nextSlide = function (options) {
    for (pagerLocation in Drupal.settings.viewsSlideshowPager[options.slideshowID]) {
      // Get the current active pager.
      var pagerNum = $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"].active').attr('id').replace('views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '_', '');
      var totalPagers = $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"]').length();

      // If we are on the last pager then activate the first pager.
      // Otherwise activate the next pager.
      pagerNum++;
      if (pagerNum == totalPagers) {
        pagerNum = 0;
      }

      // Remove active class from pagers
      $('[id^="views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '"]').removeClass('active');

      // Add active class to active pager.
      $('#views_slideshow_pager_field_item_' + pagerLocation + '_' + options.slideshowID + '_' + slideNum).addClass('active');
    }
  };


  /**
   * Views Slideshow Slide Counter
   */

  Drupal.viewsSlideshowSlideCounter = Drupal.viewsSlideshowSlideCounter || {};

  /**
   * Implement the transitionBegin for the slide counter.
   */
  Drupal.viewsSlideshowSlideCounter.transitionBegin = function (options) {
    $('#views_slideshow_slide_counter_' + options.slideshowID + ' .num').text(options.slideNum + 1);
  };

  /**
   * This is used as a router to process actions for the slideshow.
   */
  Drupal.viewsSlideshow.action = function (options) {
    // Set default values for our return status.
    var status = {
      'value': true,
      'text': ''
    }

    // If an action isn't specified return false.
    if (typeof options.action == 'undefined' || options.action == '') {
      status.value = false;
      status.text =  Drupal.t('There was no action specified.');
      return error;
    }

    // If we are using pause or play switch paused state accordingly.
    if (options.action == 'pause') {
      Drupal.settings.viewsSlideshow[options.slideshowID].paused = 1;
      // If the calling method is forcing a pause then mark it as such.
      if (options.force) {
        Drupal.settings.viewsSlideshow[options.slideshowID].pausedForce = 1;
      }
    }
    else if (options.action == 'play') {
      // If the slideshow isn't forced pause or we are forcing a play then play
      // the slideshow.
      // Otherwise return telling the calling method that it was forced paused.
      if (!Drupal.settings.viewsSlideshow[options.slideshowID].pausedForce || options.force) {
        Drupal.settings.viewsSlideshow[options.slideshowID].paused = 0;
        Drupal.settings.viewsSlideshow[options.slideshowID].pausedForce = 0;
      }
      else {
        status.value = false;
        status.text += ' ' + Drupal.t('This slideshow is forced paused.');
        return status;
      }
    }

    // We use a switch statement here mainly just to limit the type of actions
    // that are available.
    switch (options.action) {
      case "goToSlide":
      case "transitionBegin":
      case "transitionEnd":
        // The three methods above require a slide number. Checking if it is
        // defined and it is a number that is an integer.
        if (typeof options.slideNum == 'undefined' || typeof options.slideNum !== 'number' || parseInt(options.slideNum) != (options.slideNum - 0)) {
          status.value = false;
          status.text = Drupal.t('An invalid integer was specified for slideNum.');
        }
      case "pause":
      case "play":
      case "nextSlide":
      case "previousSlide":
        // Grab our list of methods.
        var methods = Drupal.settings.viewsSlideshow[options.slideshowID]['methods'];

        // if the calling method specified methods that shouldn't be called then
        // exclude calling them.
        var excludeMethodsObj = {};
        if (typeof options.excludeMethods !== 'undefined') {
          // We need to turn the excludeMethods array into an object so we can use the in
          // function.
          for (var i=0; i < excludeMethods.length; i++) {
            excludeMethodsObj[excludeMethods[i]] = '';
          }
        }

        // Call every registered method and don't call excluded ones.
        for (i = 0; i < methods[options.action].length; i++) {
          if (Drupal[methods[options.action][i]] != undefined && typeof Drupal[methods[options.action][i]][options.action] == 'function' && !(methods[options.action][i] in excludeMethodsObj)) {
            Drupal[methods[options.action][i]][options.action](options);
          }
        }
        break;

      // If it gets here it's because it's an invalid action.
      default:
        status.value = false;
        status.text = Drupal.t('An invalid action "!action" was specified.', { "!action": options.action });
    }
    return status;
  };
})(jQuery);
;
(function ($) {

/**
 * Attaches the autocomplete behavior to all required fields.
 */
Drupal.behaviors.autocomplete = {
  attach: function (context, settings) {
    var acdb = [];
    $('input.autocomplete', context).once('autocomplete', function () {
      var uri = this.value;
      if (!acdb[uri]) {
        acdb[uri] = new Drupal.ACDB(uri);
      }
      var $input = $('#' + this.id.substr(0, this.id.length - 13))
        .attr('autocomplete', 'OFF')
        .attr('aria-autocomplete', 'list');
      $($input[0].form).submit(Drupal.autocompleteSubmit);
      $input.parent()
        .attr('role', 'application')
        .append($('<span class="element-invisible" aria-live="assertive"></span>')
          .attr('id', $input.attr('id') + '-autocomplete-aria-live')
        );
      new Drupal.jsAC($input, acdb[uri]);
    });
  }
};

/**
 * Prevents the form from submitting if the suggestions popup is open
 * and closes the suggestions popup when doing so.
 */
Drupal.autocompleteSubmit = function () {
  return $('#autocomplete').each(function () {
    this.owner.hidePopup();
  }).length == 0;
};

/**
 * An AutoComplete object.
 */
Drupal.jsAC = function ($input, db) {
  var ac = this;
  this.input = $input[0];
  this.ariaLive = $('#' + this.input.id + '-autocomplete-aria-live');
  this.db = db;

  $input
    .keydown(function (event) { return ac.onkeydown(this, event); })
    .keyup(function (event) { ac.onkeyup(this, event); })
    .blur(function () { ac.hidePopup(); ac.db.cancel(); });

};

/**
 * Handler for the "keydown" event.
 */
Drupal.jsAC.prototype.onkeydown = function (input, e) {
  if (!e) {
    e = window.event;
  }
  switch (e.keyCode) {
    case 40: // down arrow.
      this.selectDown();
      return false;
    case 38: // up arrow.
      this.selectUp();
      return false;
    default: // All other keys.
      return true;
  }
};

/**
 * Handler for the "keyup" event.
 */
Drupal.jsAC.prototype.onkeyup = function (input, e) {
  if (!e) {
    e = window.event;
  }
  switch (e.keyCode) {
    case 16: // Shift.
    case 17: // Ctrl.
    case 18: // Alt.
    case 20: // Caps lock.
    case 33: // Page up.
    case 34: // Page down.
    case 35: // End.
    case 36: // Home.
    case 37: // Left arrow.
    case 38: // Up arrow.
    case 39: // Right arrow.
    case 40: // Down arrow.
      return true;

    case 9:  // Tab.
    case 13: // Enter.
    case 27: // Esc.
      this.hidePopup(e.keyCode);
      return true;

    default: // All other keys.
      if (input.value.length > 0 && !input.readOnly) {
        this.populatePopup();
      }
      else {
        this.hidePopup(e.keyCode);
      }
      return true;
  }
};

/**
 * Puts the currently highlighted suggestion into the autocomplete field.
 */
Drupal.jsAC.prototype.select = function (node) {
  this.input.value = $(node).data('autocompleteValue');
};

/**
 * Highlights the next suggestion.
 */
Drupal.jsAC.prototype.selectDown = function () {
  if (this.selected && this.selected.nextSibling) {
    this.highlight(this.selected.nextSibling);
  }
  else if (this.popup) {
    var lis = $('li', this.popup);
    if (lis.length > 0) {
      this.highlight(lis.get(0));
    }
  }
};

/**
 * Highlights the previous suggestion.
 */
Drupal.jsAC.prototype.selectUp = function () {
  if (this.selected && this.selected.previousSibling) {
    this.highlight(this.selected.previousSibling);
  }
};

/**
 * Highlights a suggestion.
 */
Drupal.jsAC.prototype.highlight = function (node) {
  if (this.selected) {
    $(this.selected).removeClass('selected');
  }
  $(node).addClass('selected');
  this.selected = node;
  $(this.ariaLive).html($(this.selected).html());
};

/**
 * Unhighlights a suggestion.
 */
Drupal.jsAC.prototype.unhighlight = function (node) {
  $(node).removeClass('selected');
  this.selected = false;
  $(this.ariaLive).empty();
};

/**
 * Hides the autocomplete suggestions.
 */
Drupal.jsAC.prototype.hidePopup = function (keycode) {
  // Select item if the right key or mousebutton was pressed.
  if (this.selected && ((keycode && keycode != 46 && keycode != 8 && keycode != 27) || !keycode)) {
    this.input.value = $(this.selected).data('autocompleteValue');
  }
  // Hide popup.
  var popup = this.popup;
  if (popup) {
    this.popup = null;
    $(popup).fadeOut('fast', function () { $(popup).remove(); });
  }
  this.selected = false;
  $(this.ariaLive).empty();
};

/**
 * Positions the suggestions popup and starts a search.
 */
Drupal.jsAC.prototype.populatePopup = function () {
  var $input = $(this.input);
  var position = $input.position();
  // Show popup.
  if (this.popup) {
    $(this.popup).remove();
  }
  this.selected = false;
  this.popup = $('<div id="autocomplete"></div>')[0];
  this.popup.owner = this;
  $(this.popup).css({
    top: parseInt(position.top + this.input.offsetHeight, 10) + 'px',
    left: parseInt(position.left, 10) + 'px',
    width: $input.innerWidth() + 'px',
    display: 'none'
  });
  $input.before(this.popup);

  // Do search.
  this.db.owner = this;
  this.db.search(this.input.value);
};

/**
 * Fills the suggestion popup with any matches received.
 */
Drupal.jsAC.prototype.found = function (matches) {
  // If no value in the textfield, do not show the popup.
  if (!this.input.value.length) {
    return false;
  }

  // Prepare matches.
  var ul = $('<ul></ul>');
  var ac = this;
  for (key in matches) {
    $('<li></li>')
      .html($('<div></div>').html(matches[key]))
      .mousedown(function () { ac.select(this); })
      .mouseover(function () { ac.highlight(this); })
      .mouseout(function () { ac.unhighlight(this); })
      .data('autocompleteValue', key)
      .appendTo(ul);
  }

  // Show popup with matches, if any.
  if (this.popup) {
    if (ul.children().length) {
      $(this.popup).empty().append(ul).show();
      $(this.ariaLive).html(Drupal.t('Autocomplete popup'));
    }
    else {
      $(this.popup).css({ visibility: 'hidden' });
      this.hidePopup();
    }
  }
};

Drupal.jsAC.prototype.setStatus = function (status) {
  switch (status) {
    case 'begin':
      $(this.input).addClass('throbbing');
      $(this.ariaLive).html(Drupal.t('Searching for matches...'));
      break;
    case 'cancel':
    case 'error':
    case 'found':
      $(this.input).removeClass('throbbing');
      break;
  }
};

/**
 * An AutoComplete DataBase object.
 */
Drupal.ACDB = function (uri) {
  this.uri = uri;
  this.delay = 300;
  this.cache = {};
};

/**
 * Performs a cached and delayed search.
 */
Drupal.ACDB.prototype.search = function (searchString) {
  var db = this;
  this.searchString = searchString;

  // See if this string needs to be searched for anyway.
  searchString = searchString.replace(/^\s+|\s+$/, '');
  if (searchString.length <= 0 ||
    searchString.charAt(searchString.length - 1) == ',') {
    return;
  }

  // See if this key has been searched for before.
  if (this.cache[searchString]) {
    return this.owner.found(this.cache[searchString]);
  }

  // Initiate delayed search.
  if (this.timer) {
    clearTimeout(this.timer);
  }
  this.timer = setTimeout(function () {
    db.owner.setStatus('begin');

    // Ajax GET request for autocompletion. We use Drupal.encodePath instead of
    // encodeURIComponent to allow autocomplete search terms to contain slashes.
    $.ajax({
      type: 'GET',
      url: db.uri + '/' + Drupal.encodePath(searchString),
      dataType: 'json',
      success: function (matches) {
        if (typeof matches.status == 'undefined' || matches.status != 0) {
          db.cache[searchString] = matches;
          // Verify if these are still the matches the user wants to see.
          if (db.searchString == searchString) {
            db.owner.found(matches);
          }
          db.owner.setStatus('found');
        }
      },
      error: function (xmlhttp) {
        alert(Drupal.ajaxError(xmlhttp, db.uri));
      }
    });
  }, this.delay);
};

/**
 * Cancels the current autocomplete request.
 */
Drupal.ACDB.prototype.cancel = function () {
  if (this.owner) this.owner.setStatus('cancel');
  if (this.timer) clearTimeout(this.timer);
  this.searchString = '';
};

})(jQuery);
;
(function ($) {

/**
 * A progressbar object. Initialized with the given id. Must be inserted into
 * the DOM afterwards through progressBar.element.
 *
 * method is the function which will perform the HTTP request to get the
 * progress bar state. Either "GET" or "POST".
 *
 * e.g. pb = new progressBar('myProgressBar');
 *      some_element.appendChild(pb.element);
 */
Drupal.progressBar = function (id, updateCallback, method, errorCallback) {
  var pb = this;
  this.id = id;
  this.method = method || 'GET';
  this.updateCallback = updateCallback;
  this.errorCallback = errorCallback;

  // The WAI-ARIA setting aria-live="polite" will announce changes after users
  // have completed their current activity and not interrupt the screen reader.
  this.element = $('<div class="progress" aria-live="polite"></div>').attr('id', id);
  this.element.html('<div class="bar"><div class="filled"></div></div>' +
                    '<div class="percentage"></div>' +
                    '<div class="message">&nbsp;</div>');
};

/**
 * Set the percentage and status message for the progressbar.
 */
Drupal.progressBar.prototype.setProgress = function (percentage, message) {
  if (percentage >= 0 && percentage <= 100) {
    $('div.filled', this.element).css('width', percentage + '%');
    $('div.percentage', this.element).html(percentage + '%');
  }
  $('div.message', this.element).html(message);
  if (this.updateCallback) {
    this.updateCallback(percentage, message, this);
  }
};

/**
 * Start monitoring progress via Ajax.
 */
Drupal.progressBar.prototype.startMonitoring = function (uri, delay) {
  this.delay = delay;
  this.uri = uri;
  this.sendPing();
};

/**
 * Stop monitoring progress via Ajax.
 */
Drupal.progressBar.prototype.stopMonitoring = function () {
  clearTimeout(this.timer);
  // This allows monitoring to be stopped from within the callback.
  this.uri = null;
};

/**
 * Request progress data from server.
 */
Drupal.progressBar.prototype.sendPing = function () {
  if (this.timer) {
    clearTimeout(this.timer);
  }
  if (this.uri) {
    var pb = this;
    // When doing a post request, you need non-null data. Otherwise a
    // HTTP 411 or HTTP 406 (with Apache mod_security) error may result.
    $.ajax({
      type: this.method,
      url: this.uri,
      data: '',
      dataType: 'json',
      success: function (progress) {
        // Display errors.
        if (progress.status == 0) {
          pb.displayError(progress.data);
          return;
        }
        // Update display.
        pb.setProgress(progress.percentage, progress.message);
        // Schedule next timer.
        pb.timer = setTimeout(function () { pb.sendPing(); }, pb.delay);
      },
      error: function (xmlhttp) {
        pb.displayError(Drupal.ajaxError(xmlhttp, pb.uri));
      }
    });
  }
};

/**
 * Display errors on the page.
 */
Drupal.progressBar.prototype.displayError = function (string) {
  var error = $('<div class="messages error"></div>').html(string);
  $(this.element).before(error).hide();

  if (this.errorCallback) {
    this.errorCallback(this);
  }
};

})(jQuery);
;
if(typeof(Drupal.ajax) !== "undefined"){
    Drupal.ajax.prototype.commands.after_cart_refresh  = function (ajax, response, status){
                    Drupal.avishay.incart();
                    Drupal.avishay.cartLinks();
    
    };
};
Drupal.avishay.link_setup_get_productName = function(context){	
    jQuery( context).addClass('ajax-processed').each(function (i,val) {
		
		var element_settings = {};
		var base = jQuery(val).attr('id');
		//~ var productName =  jQuery(val).attr('product');
		var productName =  "buy_url";
		// Clicked links look better with the throbber than the progress bar.      
		element_settings.url = '/' + productName + '/'; //jQuery(this).attr('id');
		element_settings.event = 'click';
		element_settings.submit = { "js": true, 
                                            "uid": Drupal.settings.uid, 
                                            "productName" : productName , 
                                            "nid": jQuery(val).attr("nid") };      // ::::: Here we add a query parameter.
		var ajax = new Drupal.ajax(base, val, element_settings);
		Drupal.ajax[base] = ajax;
    });
};
Drupal.avishay.link_setup_get_export = function(context){
	jQuery('a#bookmarkActionSubmit', context).each(function(i,val) {
		var element_settings = {};
		var base = jQuery(this).attr('id');
		element_settings.url = '/get_export'; //jQuery(this).attr('id');
		element_settings.event = 'click';
		element_settings.progress = { 'type': 'throbber' };
		element_settings.submit = { "js": true,  "uid": Drupal.settings.uid };      // ::::: Here we add a query parameter.
		
		var ajax = new Drupal.ajax(base, this, element_settings);
		ajax.beforeSerialize =  function (response, status) {
			var target = '';
			var len = jQuery('table tr.get_export input:checked').length;
			jQuery('table tr.get_export .bookmarkAction:checked:not(.all)').each(function(i, val){
				var nid = jQuery(val).parent().parent().attr("nid");
				var classs = String(jQuery(val).parent().parent().attr("class"));
				if(typeof(nid) === "undefined" && classs != ""){
					nid = parseInt(classs.replace(/(.*)nid-(\d*)-nid(.*)/g, "$2"));
				}
				if(i === len-1){
					target += nid;
				}	else{
					target += nid+'+';
				}
			});
			var style = jQuery('select#style option:selected').val();
			this.submit.nid = target;
			this.submit.style = style;
		};
		Drupal.ajax[base] = ajax;
	}).addClass('ajax-processed');
};
Drupal.avishay.link_setup_get_checkout = function(context){
	jQuery(context).addClass('ajax-processed').each(function (i,val) {
		var element_settings = {};
		var base = jQuery(this).attr('id');
		element_settings.url = '/get_checkout'; //jQuery(this).attr('id');
		element_settings.event = 'click';
		element_settings.progress = { 'type': 'throbber' };
		element_settings.submit = { "js": true, "xx":Array(), "uid": Drupal.settings.uid };      // ::::: Here we add a query parameter.
		
		var ajax = new Drupal.ajax(base, this, element_settings);
		//~ ajax.old_beforeSend = ajax.beforeSend;
		
		ajax.beforeSerialize =  function (response, status) {
			
		}
		Drupal.ajax[base] = ajax;
	});
};
Drupal.avishay.free_url = function(){
	/*	if the commerce link has a "free_url" class
	 * mark the view row as a free product
	 */
	jQuery('.views-field-field-commerce a.free_url').each(function(i,val){
		// fields style -- search-api-solr-view - view format = fields
		var views_row = jQuery(val).parents(".views-row");
		if(views_row.length != 0){
    		jQuery(views_row).addClass("free_url");
		}
		// table style -- my bookmark block - view format = table
		var table_row = jQuery(val).parents("tr");
		if(table_row.length != 0){
			jQuery(table_row).addClass("free_url");
		}
	});
}
Drupal.avishay.combineActionFields = function(){
	jQuery(".view-search-api-solr-view .views-row:not(.combineActionFields)").each(function(i,val){
		var div = jQuery('<div></div>').addClass("actions");
		jQuery(div).append(jQuery('.views-field.views-field-nid',val));                
		jQuery(div).append(jQuery('.views-field.views-field-field-commerce', val));
		jQuery(div).append(jQuery('.show_mlt_wrap', val));                
		jQuery(val).append(div).addClass('combineActionFields');
	});
};
Drupal.avishay.incart = function(){
		//  reset links in case  we are running after a cart refresh...
	jQuery('a.cart_export,a.url_export').each(function(i,val){
		if(jQuery(val).hasClass('cart_export')){
			jQuery(val).removeClass('cart_export').addClass('buy_export').text('רכוש ביבליו');
		}
		if(jQuery(val).hasClass('cart_url')){
			jQuery(val).removeClass('cart_url').addClass('buy_url').text('רכוש קישור');
		}
	});
	jQuery('.view-commerce-cart-form td.views-field-field-commerce-bibilio-nid, .view-flag-bookmarks.view-display-id-page_1 .views-field-field-commerce-bibilio-nid, #block-commerce-cart-cart td.views-field-field-commerce-bibilio-nid').each(function(i,val){

		var context =   jQuery(val).parent(); // tr
		var classs = jQuery( context).attr("class");
		productName = "";
		var nid = classs.replace(/(.*)nid-(\d*)-nid(.*)/i,"$2");
		var exportLink = jQuery('a.buy_export.nid_'+nid);
		var exportLinkRow = jQuery(exportLink).parent().parent();
		var urlLink = jQuery('a.buy_url.nid_'+nid);
		var urlLinkRow = jQuery(urlLink).parent().parent();
                jQuery(exportLink).text('בעגלה').addClass('cart_export').removeClass("buy_export");
                jQuery(exportLinkRow).addClass('cart_export').removeClass('buy_export').attr("cart_export",productName).attr("nid",nid);
                jQuery(urlLink).text('בעגלה').addClass('cart_url').removeClass('buy_url').unbind("click");
                jQuery(urlLinkRow).addClass('cart_url').removeClass('buy_url').attr("url_export",productName).attr("nid",nid);
	});
        //  TRANSLATION --  items
        jQuery('.view-commerce-cart-block .line-item-quantity-label').text("פריטים");
};
Drupal.avishay.cartLinks = function(context){
	var links = jQuery("a.cart_url,a.cart_export").unbind("click");
	jQuery(links).bind("click.cart", function(e){
		e.preventDefault();
		var text =  'המוצר כבר נמצא בעגלה..  להשלמת הרכישה וקבלת הקישור ';
		text = text+' <a id="checkoutNow" href="/checkout">לחץ כאן</a>';
		var settings = {"content":text ,"title" : "", "height" : 350, "width"	:350, "animate" : false};
		Drupal.avishay.shadowbox(settings);
		
		jQuery(e.currentTarget).addClass('disabled').unbind("click.cart");
		return false;
	});
}
Drupal.avishay.bookmarkFlag = function(context){
	jQuery('.flag_wrap input', context).each(function(i, val){
		var a = jQuery('a', jQuery(val).parent());
		if(jQuery(a).hasClass("unflag-action")){
				jQuery(val).attr("checked","checked");
		}
	});	
};
Drupal.avishay.flags = function(){	
	if(typeof Drupal.settings.laxo_biblio_solr === 'object' ){
		jQuery(Drupal.settings.laxo_biblio_solr.biblio_biblio_url_nodes).each(function(i,val){
			var nid = jQuery(val).attr("nid");
			var buy_url = jQuery(".nid_"+nid+".buy_url").attr({"href":val.url}).removeClass('buy_url').addClass('get_url').text("קבל קישור");
			if(val.url === ""){
				jQuery(".nid_"+nid+".buy_url").addClass('empty').text("קישור חסר!?");
			}
			var views_row = jQuery(buy_url).parents(".views-row");
			if(views_row.length !== 0){
				jQuery(views_row).removeClass('buy_url').addClass('get_url');
			}
			// table style -- my bookmark block - view format = table
			var table_row = jQuery(val).parents("tr").attr("nid", nid);
			if(table_row.length != 0){
				jQuery(table_row).removeClass('buy_url').addClass('get_url');
			}
		});
		jQuery(Drupal.settings.laxo_biblio_solr.biblio_biblio_export_nodes).each(function(i,val){
			//~ jQuery("a.export.nid_"+val.nid).attr("href",val.url)
			var val = jQuery(".nid_"+val.nid+".buy_export").removeClass("buy_export").removeClass("cart_export").addClass('get_export').text('קבל ביבליו');
			var views_row = jQuery(val).parents(".views-row");
			if(views_row.length !== 0){
				jQuery(views_row).removeClass("buy_export").removeClass("cart_export").addClass('get_export');
			}
			// table style -- my bookmark block - view format = table
			var table_row = jQuery(val).parents("tr");
			if(table_row.length !== 0){
				jQuery(table_row).removeClass("buy_export").removeClass("cart_export").addClass('get_export');
			}			//~ console.log(jQuery(".export.nid_"+val.nid));
		});
	}
}
Drupal.avishay.refresh = function(){
    if(typeof(Drupal.settings.pager_total) !== "undefined" && jQuery(".view-search-api-solr-view .fixed").length === 0){
    
    // align pager to left 
    if(jQuery('.view-search-api-solr-view .pager .pager-prev').length === 0){
            jQuery('.view-search-api-solr-view .pager ').css("text-align", "left");
    }
    if(jQuery('.view-search-api-solr-view .pager .pager-next').length === 0){
            jQuery('.view-search-api-solr-view .pager').css("text-align", "right");
    }
    // adding a total pages to the pager
    jQuery('.view-search-api-solr-view .pager .pager-next').once().before(jQuery('<li class="counter">מתוך <span>'+Drupal.settings.pager_total+'</span></li>'));
    //          
    }
     // adding a picture to represent the biblio type   
    var biblio_types = {"journal" : "מאמר מכתב עת","other" : 'שונות', "report" : 'דו"ח ממשלתי', "book" :'ספר' , "paper" : 'אוסף מאמרים לאחר וועידה', "tiza" : 'עבודת תיזה' };
    jQuery('.views-field-biblio-type .field-content').each(function(i, val){
    var field_type = jQuery(val).text();   
    jQuery.each( biblio_types , function(name, value) {
        if(value === field_type){
            jQuery(val).parents(".views-row").prepend(jQuery('<div class="type_image"></div>').addClass(name));
        }
    });

    });
    // DISAPLY MODE
    if(typeof(Drupal.settings.display_mode) !== "undefined"){
    if(Drupal.settings.display_mode === "min"){
        jQuery('#display_mode #min').click();
    }
    }
    // Adding a price to the product link
    if(typeof(Drupal.settings.url_price) !== "undefined"){
    var price =Math.round(Drupal.settings.url_price.replace(/שח/i,""))+" "+"ש\"ח";
    jQuery(".url_price").text(price );
    }
    // keywords link
    jQuery('.views-field-biblio-keywords .field-content').each(function(i, val){
                        var keys =    jQuery(val).text().split(",");
                        jQuery(val).text("");
                        var keywords = "";
                        jQuery.each(keys, function(ii, vv){
                            
                            //vv = jQuery(vv).trim();
                            
                            var link = window.location.hostname+window.location.pathname+"?f[90]=biblio_keywords:"+vv;
                            jQuery(val).append(jQuery('<a href="http://'+link+'">'+vv+'</a><span>, </span>'));
                        });
                    jQuery("span", val).last().remove();
                    });

};
Drupal.ajax.prototype.commands.ajax_buy_response = function (ajax, response, status) {
    	
    		//~ Drupal.avishay.msg(Array(response.data),	jQuery('#header'),	 600);
    		//~ var settings = {"content":response.data ,"title" : "", "height" : 600, "width"	:800, "animate" : false};
			//~ Drupal.avishay.shadowbox(settings);
			Drupal.avishay.incart();
//			var notice = '<div class="notice purr avishaycsspurr" ><div class="notice-body">';
//			notice += response.data;
//			notice += '</div><div class="notice-bottom"></div></div>';
//			jQuery(notice).purr(); 
                        if(typeof(cartTimer) !== "undefined"){
                            jQuery('#cart-toaster').stop(true, true);
                            
                        }
                        
                        jQuery('#cart-toaster').css("display","block");
                        jQuery('#toaster-content #current_msg').html(response.data);
                        var height = jQuery('#toaster').height();
                        
                        var top = (height+12) *-1;
                        jQuery('#cart-toaster').css("display","block").animate({"opacity":"1","top":top,"height":height}, 700);
                        var cartTimer = window.setTimeout(function(){
                            jQuery('#cart-toaster').css("display","block").animate({"opacity":"0","top":0}, 500,function(){
                                jQuery('#cart-toaster').css("display","none");
                            });
                        },5000);
                        


  };
Drupal.ajax.prototype.commands.ajax_buy_response_shadowbox = function (ajax, response, status) {
                    jQuery("#buy_url_" + response.data).replaceWith(jQuery('<a class="cart_url" href="#">בעגלה</a>'));
            };
Drupal.ajax.prototype.commands.ajax_get_export_output = function (ajax, response, status) {
                    var settings = {"content":response.data ,"title" : "", "height" : 600, "width"	:800, "animate" : false};
                    Drupal.avishay.shadowbox(settings);
};
Drupal.behaviors.avishay = {
            attach : function(context, settings ){
                
                    if(typeof(context) === "object"){
                            if(jQuery(context).parent().parent().attr("id") === "block-views-flag-bookmarks-block-2"){
                                    Drupal.avishay.bookmarkAttach(context);
                            } 
                            if(jQuery(context).parents("#block-system-main").length === 1  && jQuery(context).hasClass("view-search-api-solr-view")){
                                    //~ Drupal.avishay.combineActionFields();
                            }
                    } else {
                        Drupal.avishay.bookmarkAttach();
                    }
                    // TODO: make this context releveant
                    if(typeof(Drupal.avishay.flags) !== "undefined"){Drupal.avishay.flags();};

                    Drupal.avishay.incart();
                    Drupal.avishay.cartLinks();
                    Drupal.avishay.free_url();
                    Drupal.avishay.link_setup_get_productName(jQuery('.buy_url[id]:not(.ajax-processed)'));
                    Drupal.avishay.link_setup_get_productName(jQuery('.buy_export[id]:not(.ajax-processed)'));
                    Drupal.avishay.combineActionFields();
                    Drupal.avishay.bookmarkFlag();
                    //var refreshTimer = window.setTimeout(function(){
                                           Drupal.avishay.refresh();  
                                           
//                                   }, 3000);
            }
            
    };
Drupal.avishay.row = '<div class="views-row "><div class="type_image journal"></div><span class="views-field views-field-biblio-custom1"><span class="field-content"></span></span><span id="sep">|</span><span class="views-field views-field-biblio-year"><span class="field-content"></span></span><div class="views-field views-field-field-biblio-research"><span class="views-label views-label-field-biblio-research">תחום: </span><span class="field-content"></span></div><div class="views-field views-field-field-biblio-qualitive">        <span class="field-content">   <span class="views-label views-label-field-biblio-research">שיטת מחקר: </span>    <span class="field-content">איכותני (ניתוח מקרה)</span></span></div><div class="views-field views-field-biblio-type"><span class="views-label views-label-biblio-type">סוג: </span><span class="field-content"></span></div><div class="views-field views-field-biblio-keywords">    <span class="views-label views-label-biblio-keywords">מילות מפתח: </span>    <span class="field-content"></span>  </div><div></div><div class="actions"><div class="views-field views-field-field-commerce">        <span class="field-content"><a href="" id="" class="free">קרא חינם</a></span>  </div><div class="escholar-color-scheme-front-light-blue show_mlt_wrap"><a href="#">מצאתי שגיאה</a></div></div></div>';
jQuery(document).ready(function(){
    // ####  collapse unused block-facetapi
    jQuery('.block-facetapi').each(function(i,block){
        if(   jQuery("input[type=checkbox]:checked",block).length === 0 ){
            jQuery(".block-title:not(.collapsiblockCollapsed)", block).click();
        }
    });
// ####     cart popup -- toaster    
    jQuery("#toaster-remove").live("click", function(){
        jQuery('#cart-toaster').css("display","block").animate({"opacity":"0","top":0}, 500,function(){
                jQuery('#cart-toaster').css("display","none");
        });
    });
//  ####     DISPLAY MOED

jQuery('#display_mode #min').live("click",  function(e){
   jQuery('.type_image,.views-field-field-biblio-research, .views-field-field-biblio-qualitive, .views-field-biblio-type, .views-field-biblio-keywords, .views-field-field-biblio-quantitative').hide(); 
   Drupal.settings.display_mode = "min";
   
});
jQuery('#display_mode #max').live("click",  function(e){
   jQuery('.type_image,.views-field-field-biblio-research, .views-field-field-biblio-qualitive, .views-field-biblio-type, .views-field-biblio-keywords, .views-field-field-biblio-quantitative').show();  
   Drupal.settings.display_mode = "max";
});

//  ### add to cart message popup
jQuery('#region-preface-third .region-inner').append(jQuery('<div id="cart-toaster"><div id="toaster"><div id="toaster-header"><h5>העגלה עודכנה</h5><a id="toaster-remove"></a><div class="cl"></div></div><div id="toaster-content"><div id="current_msg"></div><a href="/checkout">לקופה</a></div></div></div>'));

var bottom_login = jQuery('#user-login-form').clone();

jQuery("#shopping-cart", bottom_login).remove();
var bottom_login_menu = jQuery("ul", bottom_login).clone();
jQuery("ul", bottom_login).remove();
jQuery("#block-login-toggle",  bottom_login_menu ).bind("click", function(){
    jQuery("#region-preface-third form").toggle();

});
jQuery('body.not-logged-in #region-preface-third .region-inner').prepend(jQuery('<div class="login"></div>').append(bottom_login_menu).append(bottom_login));
jQuery('#block-commerce-cart-cart .content .cart-empty-block, #block-commerce-cart-cart .view-content,#block-views-flag-bookmarks-block-2 .view-empty').css("cursor","pointer").bind("click", function(e){    
    
    jQuery(".block-title",jQuery(e.currentTarget).parents('.block')).click();
});

// FACETAPI BLOCKS - region title
jQuery('.region-inner.region-sidebar-first-inner').prepend(jQuery('<div title="חיפוש מתקדם" id="advanced_search_title"><h2>חיפוש מתקדם:</h2></div>'));

// adding a checkbox indection for the bookmark flags
jQuery('.flag_wrap input:checked').live("click", function(e){
        var a = jQuery('a', jQuery(e.currentTarget).parent());
        if(jQuery(a).hasClass("flag-action")){
                jQuery(a).click();
        } else {
                e.preventDefault();
                return false;
        }
});	
jQuery('.flag_wrap input:not(:checked)').live("click", function(e){
        var a = jQuery('a', jQuery(e.currentTarget).parent());
        if(jQuery(a).hasClass("unflag-action")){
                jQuery(a).click();
        } else {
                e.preventDefault();
                return false;
        }
});
jQuery('a.free_url,a.buy_url,a.get_url').live("mouseup",function(e){
                jQuery(".buy_export", jQuery(e.currentTarget).parent()).show();
});
jQuery('a.empty').unbind("click").die("click").live("click", function(e){
        e.preventDefault();
        return false;
});




// cart more like this 
jQuery('.view-commerce-cart-form td.views-field-field-commerce-bibilio-nid').each(function(i, val){
//        var nid = parseInt(jQuery(val).text());
        var nid = jQuery(val).text();

        var mlt_action = jQuery('<a href="#" nid="'+nid+'" class="show_mlt mlt_action">מאמרים דומים</a>');
        jQuery(val).text("").append(mlt_action);
});

// more like this 
Drupal.avishay.not_cart_page = jQuery('body').hasClass("page-search");//indivation to change change number of resulte for the cart page
jQuery('a.close_mlt').live("click", function(e){
        e.preventDefault();
        jQuery( ".mlt_arrow",jQuery(e.currentTarget).parent()).remove();
        //var nid = jQuery(e.currentTarget).attr("nid");
        //jQuery('#mlt_'+nid).remove();
        jQuery( ".mlt",jQuery(e.currentTarget).parents(".views-row")).css("overflow","hidden").hide(500, function () {
                                                                                        jQuery(this).parent().remove();
                                                                                    });
        jQuery(e.currentTarget).text("מאמרים דומים").removeClass("close_mlt").addClass("show_mlt");
        return false;
});

jQuery('a.show_mlt').live("click", function(e){
    e.preventDefault();
    jQuery(e.currentTarget).text("טוען מאמרים דומים").removeClass("show_mlt").addClass("close_mlt loading").after(jQuery('<div class="mlt_arrow"></div>'));
    var nid = jQuery(e.currentTarget).attr("nid");

    var mlt_box = jQuery('<div class="mlt_wrap" id="mlt_'+nid+'" ></div>');
    var url = 'http://devel.avishay.tk:8080/solr/dev/mlt?q=item_id:'+nid+'&mlt.fl=id,t_title&mlt.mindf=1&mlt.mintf=1&fl=*&wt=json&json.wrf=?';
    if(Drupal.avishay.not_cart_page){
            url = url + '&rows=5';
    }else{
            url = url + '&rows=2';
    }

    //~ var originalRow = jQuery(e.currentTarget).parents('.views-row');
    var originalRow = jQuery(Drupal.avishay.row);

    jQuery.getJSON(url, function(json) {
            if(json.response.numFound === 0){
                    jQuery(originalRow).addClass("no_mlt").css("background", "rgba(255,0,0,0.1)");
                    jQuery(e.currentTarget).after(jQuery('<span> אין תוצאות דומות למאמר זה </span>')).remove();
            } 
            jQuery(json.response.docs).each(function(i, val){
                    
                    // remove  ":" from objects name 
                    jQuery.each(val, function(name, value){
                        var reg = /:/i;
                        if(name.match(reg)){             
                            
                        newname = name.replace(reg, "");
                        val[newname] = value;
                        //val[name].delete;
                     }
                    });
                    var keywords = "", sep = ', ';
                    
                    //make sure we have our title field and genrate a new row for the item
                    if(typeof(val.t_biblio_custom1) !== "undefined"){
                            
                            var mltRow = jQuery(originalRow).clone().css({"direction" : "rtl"}).addClass("mlt");
                            // BIBLIO CUSTOM1
                            jQuery(".views-field-biblio-custom1 .field-content", mltRow).text( val.t_biblio_custom1[0] );	
                            // TYPE
                            
                             jQuery(".views-field-biblio-type .field-content", mltRow).text( val.f_ss_biblio_type) ;	
                            // YEAR
                            jQuery(".views-field-biblio-year .field-content", mltRow).text( val.is_biblio_year) ;	
                           
                            // RESEARCH field
                            jQuery(val.f_sm_field_biblio_researchname).each(function(i,keyword){        
                                if(jQuery(val.f_sm_field_biblio_researchname).length === i+1  ){
                                    keywords = keywords + keyword ;
                                }else {
                                    keywords = keywords+ keyword + sep; 		
                                }
                            });
                            if(keywords !== ""){
                                    jQuery(".views-field-field-biblio-research .field-content", mltRow).text(keywords );	
                            }

                            // catalog TYPE -- qualitive /quantitive
                            keywords = "";
                                // qualitivename
                            jQuery(val.f_sm_field_biblio_qualitivename).each(function(i,keyword){        
                            
                            if(jQuery(val.f_sm_field_biblio_qualitivename).length === i+1  ){
                                            keywords = keywords + keyword ;
                                            
                                    }else {
                                            keywords = keywords+ keyword + sep; 		
                                    }
                            });
                            if(keywords !== ""){
                                    jQuery(".views-field-field-biblio-qualitive .field-content .field-content", mltRow).text("איכותני ("+keywords+")" );	
                            } else {
                                 jQuery(".views-field-field-biblio-qualitive", mltRow).remove();
                            }
                            keywords = "";
                                // quantitative:name
                            jQuery(val.f_sm_field_biblio_quantitativename).each(function(i,keyword){        
                            
                            if(jQuery(val.f_sm_field_biblio_quantitativename).length === i+1  ){
                                            keywords = keywords + keyword ;
                                    }else {
                                            keywords = keywords+ keyword + sep; 		
                                    }
                            });
                            if(keywords !== ""){
                                    jQuery(".views-field-field-biblio-quantitative .field-content .field-content", mltRow).text("כמותני ("+keywords+")" );	
                            } else {
                                 jQuery(".views-field-field-biblio-qualitive", mltRow).remove();
                            }

                            // KEYWORDS
                            keywords = "";
                            
                            jQuery(val.f_sm_biblio_keywords).each(function(i,keyword){
                                    if(jQuery(val.f_sm_biblio_keywords).length === i+1){
                                            keywords = keywords + keyword ;
                                    }else {
                                            keywords = keywords+ keyword + sep; 		
                                    }
                            });
                            jQuery(".views-field-biblio-keywords .field-content", mltRow).text( keywords );	

                            // COMMERCE
                            if(	parseInt(val.im_field_commerce) === 1 ) {
                                    jQuery(".views-field-field-commerce .field-content a", mltRow).attr({
                                                                            "class":	"nid_"+val.is_nid+" buy_url",
                                                                            "product":	"buy_url",
                                                                            "nid":		val.is_nid, 
                                                                            "id":		"buy_url_"+val.is_nid,
                                                                            "href":		"#"}).text("קרא \\ רכוש").removeClass("ajax-processed");
                            } else {
                                    jQuery(".views-field-field-commerce .field-content a", mltRow).attr({
                                            "href":	"/free/url/" + val.is_nid,
                                            "id":		"nid_" + val.is_nid,
                                            "class":"free"
                                            }).text("קרא בחינם").removeClass("ajax-processed");
                            }
                            // MLT_ACTION
                            jQuery("a.mlt_action", mltRow).text("תוצאות דומות").removeClass("close_mlt").addClass("show_mlt").attr(	"nid", val.is_nid );

                            //~ Drupal.avishay.combineActionFields();
                            if(jQuery('body').hasClass("page-search")){
                                    Drupal.avishay.bookmarkAttach();
                                    Drupal.avishay.incart();
                                    Drupal.avishay.free_url();
                                    Drupal.avishay.cartLinks();
                                    Drupal.avishay.bookmarkFlag();
                                    
                                    jQuery(e.currentTarget).text("סגור מאמרים דומים");

                            }
                                    jQuery(e.currentTarget).removeClass("loading");
                                    jQuery(mlt_box).append(mltRow);
                                   var refreshTimer = window.setTimeout(function(){
                                           Drupal.avishay.refresh();  
                                           
                                   }, 100);
                    }	

            });

    if(Drupal.avishay.not_cart_page){

            Drupal.avishay.link_setup_get_productName(jQuery('.buy_url[id]:not(.ajax-processed)', mlt_box));		
//			jQuery(e.currentTarget).parents('.views-row').append(mlt_box);		
            jQuery(e.currentTarget).parents('.views-row').append(mlt_box);		
            
            if(typeof(Drupal.settings.display_mode) !== "undefined"){
                if(Drupal.settings.display_mode === "min"){
                        jQuery('#display_mode #min').click();
                }
            }
            var offset = jQuery(mlt_box).offset();
            window.scroll(0,offset.top-10);

    } else {
//~ 
            var settings = {"content": jQuery(mlt_box).css("background-color", "#fff").html()  ,"title" : "", "height" : 450, "width"	:650, "animate" : false};
            Drupal.avishay.shadowbox(settings);
    //~ 
    }

    });

    //~ console.log(mltRow);
    return false;

});

	Drupal.avishay.combineActionFields();
	Drupal.avishay.bookmarkAttach();
	Drupal.avishay.incart();
	Drupal.avishay.free_url();
	Drupal.avishay.cartLinks();
	Drupal.avishay.bookmarkFlag();
        Drupal.avishay.refresh();
        


// ####    on BACK btn BUG FIX
jQuery('<div id="cart_refresh" style="display:none;"></div>').addClass('ajax-processed').each(function (i,val) {
		var element_settings = {};
		var base = jQuery(this).attr('id');
		element_settings.url = '/get_cart'; //jQuery(this).attr('id');
		element_settings.event = 'click';
		element_settings.progress = { 'type': 'throbber' };
		element_settings.submit = { "js": true, "xx":Array(), "uid": Drupal.settings.uid };      // ::::: Here we add a query parameter.
		
		var ajax = new Drupal.ajax(base, this, element_settings);
		ajax.beforeSerialize =  function (response, status) {

		};
//                ajax.success = fu
//		Drupal.ajax[base] = ajax;
}).click();

// ie fixes..
jQuery(".block-commerce-cart h2").css("float","none");
});


;
/**
 * @file
 * Some basic behaviors and utility functions for Views.
 */
(function ($) {

Drupal.Views = {};

/**
 * jQuery UI tabs, Views integration component
 */
Drupal.behaviors.viewsTabs = {
  attach: function (context) {
    if ($.viewsUi && $.viewsUi.tabs) {
      $('#views-tabset').once('views-processed').viewsTabs({
        selectedClass: 'active'
      });
    }

    $('a.views-remove-link').once('views-processed').click(function(event) {
      var id = $(this).attr('id').replace('views-remove-link-', '');
      $('#views-row-' + id).hide();
      $('#views-removed-' + id).attr('checked', true);
      event.preventDefault();
   });
  /**
    * Here is to handle display deletion
    * (checking in the hidden checkbox and hiding out the row)
    */
  $('a.display-remove-link')
    .addClass('display-processed')
    .click(function() {
      var id = $(this).attr('id').replace('display-remove-link-', '');
      $('#display-row-' + id).hide();
      $('#display-removed-' + id).attr('checked', true);
      return false;
  });
  }
};

/**
 * Helper function to parse a querystring.
 */
Drupal.Views.parseQueryString = function (query) {
  var args = {};
  var pos = query.indexOf('?');
  if (pos != -1) {
    query = query.substring(pos + 1);
  }
  var pairs = query.split('&');
  for(var i in pairs) {
    if (typeof(pairs[i]) == 'string') {
      var pair = pairs[i].split('=');
      // Ignore the 'q' path argument, if present.
      if (pair[0] != 'q' && pair[1]) {
        args[decodeURIComponent(pair[0].replace(/\+/g, ' '))] = decodeURIComponent(pair[1].replace(/\+/g, ' '));
      }
    }
  }
  return args;
};

/**
 * Helper function to return a view's arguments based on a path.
 */
Drupal.Views.parseViewArgs = function (href, viewPath) {
  var returnObj = {};
  var path = Drupal.Views.getPath(href);
  // Ensure we have a correct path.
  if (viewPath && path.substring(0, viewPath.length + 1) == viewPath + '/') {
    var args = decodeURIComponent(path.substring(viewPath.length + 1, path.length));
    returnObj.view_args = args;
    returnObj.view_path = path;
  }
  return returnObj;
};

/**
 * Strip off the protocol plus domain from an href.
 */
Drupal.Views.pathPortion = function (href) {
  // Remove e.g. http://example.com if present.
  var protocol = window.location.protocol;
  if (href.substring(0, protocol.length) == protocol) {
    // 2 is the length of the '//' that normally follows the protocol
    href = href.substring(href.indexOf('/', protocol.length + 2));
  }
  return href;
};

/**
 * Return the Drupal path portion of an href.
 */
Drupal.Views.getPath = function (href) {
  href = Drupal.Views.pathPortion(href);
  href = href.substring(Drupal.settings.basePath.length, href.length);
  // 3 is the length of the '?q=' added to the url without clean urls.
  if (href.substring(0, 3) == '?q=') {
    href = href.substring(3, href.length);
  }
  var chars = ['#', '?', '&'];
  for (i in chars) {
    if (href.indexOf(chars[i]) > -1) {
      href = href.substr(0, href.indexOf(chars[i]));
    }
  }
  return href;
};

})(jQuery);
;
(function ($) {

Drupal.behaviors.facetapi = {
  attach: function(context, settings) {
    // Iterates over facet settings, applies functionality like the "Show more"
    // links for block realm facets.
    // @todo We need some sort of JS API so we don't have to make decisions
    // based on the realm.
    if (settings.facetapi) {
      for (var index in settings.facetapi.facets) {
        if (null != settings.facetapi.facets[index].makeCheckboxes) {
          // Find all checkbox facet links and give them a checkbox.
          $('#' + settings.facetapi.facets[index].id + ' a.facetapi-checkbox', context).each(Drupal.facetapi.makeCheckbox);
        }
        if (null != settings.facetapi.facets[index].limit) {
          // Applies soft limit to the list.
          Drupal.facetapi.applyLimit(settings.facetapi.facets[index]);
        }
      }
    }
  }
}

/**
 * Class containing functionality for Facet API.
 */
Drupal.facetapi = {}

/**
 * Applies the soft limit to facets in the block realm.
 */
Drupal.facetapi.applyLimit = function(settings) {
  if (settings.limit > 0 && !$('ul#' + settings.id).hasClass('facetapi-processed')) {
    // Only process this code once per page load.
    $('ul#' + settings.id).addClass('facetapi-processed');

    // Ensures our limit is zero-based, hides facets over the limit.
    var limit = settings.limit - 1;
    $('ul#' + settings.id).find('li:gt(' + limit + ')').hide();

    // Adds "Show more" / "Show fewer" links as appropriate.
    $('ul#' + settings.id).filter(function() {
      return $(this).find('li').length > settings.limit;
    }).each(function() {
      $('<a href="#" class="facetapi-limit-link"></a>').text(Drupal.t('Show more')).click(function() {
        if ($(this).prev().find('li:hidden').length > 0) {
          $(this).prev().find('li:gt(' + limit + ')').slideDown();
          $(this).addClass('open').text(Drupal.t('Show fewer'));
        }
        else {
          $(this).prev().find('li:gt(' + limit + ')').slideUp();
          $(this).removeClass('open').text(Drupal.t('Show more'));
        }
        return false;
      }).insertAfter($(this));
    });
  }
}

/**
 * Constructor for the facetapi redirect class.
 */
Drupal.facetapi.Redirect = function(href) {
  this.href = href;
}

/**
 * Method to redirect to the stored href.
 */
Drupal.facetapi.Redirect.prototype.gotoHref = function() {
  window.location.href = this.href;
}

/**
 * Replace an unclick link with a checked checkbox.
 */
Drupal.facetapi.makeCheckbox = function() {
  var $link = $(this);
  if (!$link.hasClass('facetapi-checkbox-processed')) {
    var active;
    if ($link.hasClass('facetapi-inactive')) {
      active = false;
    }
    else if ($link.hasClass('facetapi-active')) {
      active = true;
    }
    else {
      // Not a facet link.
      return;
    }
    var checkbox = active ? $('<input type="checkbox" class="facetapi-checkbox" checked="true" />') : $('<input type="checkbox" class="facetapi-checkbox" />');
    // Get the href of the link that is this DOM object.
    var href = $link.attr('href');
    redirect = new Drupal.facetapi.Redirect(href);
    checkbox.click($.proxy(redirect, 'gotoHref'));
    if (active) {
      // Add the checkbox, hide the link.
      $link.before(checkbox).hide();
    }
    else {
      $link.before(checkbox);
    }
    $link.removeClass('facetapi-checkbox').addClass('facetapi-checkbox-processed');
  }
}

})(jQuery);
;

(function($) {

  /**
   * Trigger the Update button when hitting the enter key.
   */
  Drupal.behaviors.commerceLineItemForm = {
    attach: function (context, settings) {
      // Click the update button, not the remove button on enter key if we are
      // on a text field.
      $('div.commerce-line-item-views-form > form input.form-text', context).keydown(function(event) {
        if (event.keyCode === 13) {
          // Prevent browser's default submit from being clicked.
          event.preventDefault();
          $('input#edit-update', $(this).parents('form')).click();
        }
      });
    }
  }

})(jQuery);
;
(function ($) {

/**
 * Handler for the "keyup" event.
 *
 * Overwritten from Drupal's autocomplete.js to automatically submit the form
 * when Enter is hit.
 */
Drupal.jsAC.prototype.onkeyup = function (input, e) {
  if (!e) {
    e = window.event;
  }
  switch (e.keyCode) {
    case 16: // Shift.
    case 17: // Ctrl.
    case 18: // Alt.
    case 20: // Caps lock.
    case 33: // Page up.
    case 34: // Page down.
    case 35: // End.
    case 36: // Home.
    case 37: // Left arrow.
    case 38: // Up arrow.
    case 39: // Right arrow.
    case 40: // Down arrow.
      return true;

    case 9:  // Tab.
    case 13: // Enter.
    case 27: // Esc.
      this.hidePopup(e.keyCode);
      if (13 == e.keyCode && $(input).hasClass('auto_submit')) {
        input.form.submit();
      }
      return true;

    default: // All other keys.
      if (input.value.length > 0)
        this.populatePopup();
      else
        this.hidePopup(e.keyCode);
      return true;
  }
};

// Auto-submit main search input after autocomplete
if ( typeof Drupal.jsAC != 'undefined') {
  Drupal.jsAC.prototype.select = function(node) {
    this.input.value = $(node).data('autocompleteValue');
    if ($(this.input).hasClass('auto_submit')) {

      if (typeof Drupal.search_api_ajax != 'undefined') {
        // Use Search API Ajax to submit
        Drupal.search_api_ajax.navigateQuery($(this.input).val());
      } else {
        this.input.form.submit();
      }

    }
  };
}

/**
* Performs a cached and delayed search.
*/
Drupal.ACDB.prototype.search = function (searchString) {
  var db = this;
  this.searchString = searchString;

  // See if this string needs to be searched for anyway.
  searchString = searchString.replace(/^\s+|\s+$/, '');
  if (searchString.length <= 0 ||
    searchString.charAt(searchString.length - 1) == ',') {
    return;
  }

  // See if this key has been searched for before.
  if (this.cache[searchString]) {
    return this.owner.found(this.cache[searchString]);
  }

  // Initiate delayed search.
  if (this.timer) {
    clearTimeout(this.timer);
  }
  this.timer = setTimeout(function () {
    db.owner.setStatus('begin');

    // Ajax GET request for autocompletion. We use Drupal.encodePath instead of
    // encodeURIComponent to allow autocomplete search terms to contain slashes.
    $.ajax({
      type: 'GET',
      url: db.uri + '/' + Drupal.encodePath(searchString),
      dataType: 'json',
      success: function (matches) {
        if (typeof matches.status == 'undefined' || matches.status != 0) {
          db.cache[searchString] = matches;
          // Verify if these are still the matches the user wants to see.
          if (db.searchString == searchString) {
            db.owner.found(matches);
          }
          db.owner.setStatus('found');
        }
      },
      error: function (xmlhttp) {
        if (xmlhttp.status) {
          alert(Drupal.ajaxError(xmlhttp, db.uri));
        }
      }
    });
  }, this.delay);
};

})(jQuery);
;
(function ($) {

/**
 * Terminology:
 *
 *   "Link" means "Everything which is in flag.tpl.php" --and this may contain
 *   much more than the <A> element. On the other hand, when we speak
 *   specifically of the <A> element, we say "element" or "the <A> element".
 */

/**
 * The main behavior to perform AJAX toggling of links.
 */
Drupal.flagLink = function(context) {
  /**
   * Helper function. Updates a link's HTML with a new one.
   *
   * @param element
   *   The <A> element.
   * @return
   *   The new link.
   */
  function updateLink(element, newHtml) {
    var $newLink = $(newHtml);

    // Initially hide the message so we can fade it in.
    $('.flag-message', $newLink).css('display', 'none');

    // Reattach the behavior to the new <A> element. This element
    // is either whithin the wrapper or it is the outer element itself.
    var $nucleus = $newLink.is('a') ? $newLink : $('a.flag', $newLink);
    $nucleus.addClass('flag-processed').click(flagClick);

    // Find the wrapper of the old link.
    var $wrapper = $(element).parents('.flag-wrapper:first');
    if ($wrapper.length == 0) {
      // If no ancestor wrapper was found, or if the 'flag-wrapper' class is
      // attached to the <a> element itself, then take the element itself.
      $wrapper = $(element);
    }
    // Replace the old link with the new one.
    $wrapper.after($newLink).remove();
    Drupal.attachBehaviors($newLink.get(0));

    $('.flag-message', $newLink).fadeIn();
    setTimeout(function(){ $('.flag-message', $newLink).fadeOut() }, 3000);
    return $newLink.get(0);
  }

  /**
   * A click handler that is attached to all <A class="flag"> elements.
   */
  function flagClick() {
    // 'this' won't point to the element when it's inside the ajax closures,
    // so we reference it using a variable.
    var element = this;

    // While waiting for a server response, the wrapper will have a
    // 'flag-waiting' class. Themers are thus able to style the link
    // differently, e.g., by displaying a throbber.
    var $wrapper = $(element).parents('.flag-wrapper');
    if ($wrapper.is('.flag-waiting')) {
      // Guard against double-clicks.
      return false;
    }
    $wrapper.addClass('flag-waiting');

    // Hide any other active messages.
    $('span.flag-message:visible').fadeOut();

    // Send POST request
    $.ajax({
      type: 'POST',
      url: element.href,
      data: { js: true },
      dataType: 'json',
      success: function (data) {
        if (data.status) {
          // Success.
          data.link = $wrapper.get(0);
          $.event.trigger('flagGlobalBeforeLinkUpdate', [data]);
          if (!data.preventDefault) { // A handler may cancel updating the link.
            data.link = updateLink(element, data.newLink);
          }
          $.event.trigger('flagGlobalAfterLinkUpdate', [data]);
        }
        else {
          // Failure.
          alert(data.errorMessage);
          $wrapper.removeClass('flag-waiting');
        }
      },
      error: function (xmlhttp) {
        alert('An HTTP error '+ xmlhttp.status +' occurred.\n'+ element.href);
        $wrapper.removeClass('flag-waiting');
      }
    });
    return false;
  }

  $('a.flag-link-toggle:not(.flag-processed)', context).addClass('flag-processed').click(flagClick);
};

/**
 * Prevent anonymous flagging unless the user has JavaScript enabled.
 */
Drupal.flagAnonymousLinks = function(context) {
  $('a.flag:not(.flag-anonymous-processed)', context).each(function() {
    this.href += (this.href.match(/\?/) ? '&' : '?') + 'has_js=1';
    $(this).addClass('flag-anonymous-processed');
  });
}

String.prototype.flagNameToCSS = function() {
  return this.replace(/_/g, '-');
}

/**
 * A behavior specifically for anonymous users. Update links to the proper state.
 */
Drupal.flagAnonymousLinkTemplates = function(context) {
  // Swap in current links. Cookies are set by PHP's setcookie() upon flagging.

  var templates = Drupal.settings.flag.templates;

  // Build a list of user-flags.
  var userFlags = Drupal.flagCookie('flags');
  if (userFlags) {
    userFlags = userFlags.split('+');
    for (var n in userFlags) {
      var flagInfo = userFlags[n].match(/(\w+)_(\d+)/);
      var flagName = flagInfo[1];
      var contentId = flagInfo[2];
      // User flags always default to off and the JavaScript toggles them on.
      if (templates[flagName + '_' + contentId]) {
        $('.flag-' + flagName.flagNameToCSS() + '-' + contentId, context).after(templates[flagName + '_' + contentId]).remove();
      }
    }
  }

  // Build a list of global flags.
  var globalFlags = document.cookie.match(/flag_global_(\w+)_(\d+)=([01])/g);
  if (globalFlags) {
    for (var n in globalFlags) {
      var flagInfo = globalFlags[n].match(/flag_global_(\w+)_(\d+)=([01])/);
      var flagName = flagInfo[1];
      var contentId = flagInfo[2];
      var flagState = (flagInfo[3] == '1') ? 'flag' : 'unflag';
      // Global flags are tricky, they may or may not be flagged in the page
      // cache. The template always contains the opposite of the current state.
      // So when checking global flag cookies, we need to make sure that we
      // don't swap out the link when it's already in the correct state.
      if (templates[flagName + '_' + contentId]) {
        $('.flag-' + flagName.flagNameToCSS() + '-' + contentId, context).each(function() {
          if ($(this).find('.' + flagState + '-action').size()) {
            $(this).after(templates[flagName + '_' + contentId]).remove();
          }
        });
      }
    }
  }
}

/**
 * Utility function used to set Flag cookies.
 *
 * Note this is a direct copy of the jQuery cookie library.
 * Written by Klaus Hartl.
 */
Drupal.flagCookie = function(name, value, options) {
  if (typeof value != 'undefined') { // name and value given, set cookie
    options = options || {};
    if (value === null) {
      value = '';
      options = $.extend({}, options); // clone object since it's unexpected behavior if the expired property were changed
      options.expires = -1;
    }
    var expires = '';
    if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
      var date;
      if (typeof options.expires == 'number') {
        date = new Date();
        date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
      } else {
        date = options.expires;
      }
      expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
    }
    // NOTE Needed to parenthesize options.path and options.domain
    // in the following expressions, otherwise they evaluate to undefined
    // in the packed version for some reason...
    var path = options.path ? '; path=' + (options.path) : '';
    var domain = options.domain ? '; domain=' + (options.domain) : '';
    var secure = options.secure ? '; secure' : '';
    document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
  } else { // only name given, get cookie
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
        var cookie = jQuery.trim(cookies[i]);
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) == (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
};

Drupal.behaviors.flagLink = {};
Drupal.behaviors.flagLink.attach = function(context) {
  // For anonymous users with the page cache enabled, swap out links with their
  // current state for the user.
  if (Drupal.settings.flag && Drupal.settings.flag.templates) {
    Drupal.flagAnonymousLinkTemplates(context);
  }

  // For all anonymous users, require JavaScript for flagging to prevent spiders
  // from flagging things inadvertently.
  if (Drupal.settings.flag && Drupal.settings.flag.anonymous) {
    Drupal.flagAnonymousLinks(context);
  }

  // On load, bind the click behavior for all links on the page.
  Drupal.flagLink(context);
};

})(jQuery);
;
/**
 * @file
 * Handles AJAX fetching of views, including filter submission and response.
 */
(function ($) {

/**
 * Attaches the AJAX behavior to Views exposed filter forms and key View links.
 */
Drupal.behaviors.ViewsAjaxView = {};
Drupal.behaviors.ViewsAjaxView.attach = function() {
  if (Drupal.settings && Drupal.settings.views && Drupal.settings.views.ajaxViews) {
    $.each(Drupal.settings.views.ajaxViews, function(i, settings) {
      Drupal.views.instances[i] = new Drupal.views.ajaxView(settings);
    });
  }
};

Drupal.views = {};
Drupal.views.instances = {};

/**
 * Javascript object for a certain view.
 */
Drupal.views.ajaxView = function(settings) {
  var selector = '.view-dom-id-' + settings.view_dom_id;
  this.$view = $(selector);

  // Retrieve the path to use for views' ajax.
  var ajax_path = Drupal.settings.views.ajax_path;

  // If there are multiple views this might've ended up showing up multiple times.
  if (ajax_path.constructor.toString().indexOf("Array") != -1) {
    ajax_path = ajax_path[0];
  }

  // Check if there are any GET parameters to send to views.
  var queryString = window.location.search || '';
  if (queryString !== '') {
    // Remove the question mark and Drupal path component if any.
    var queryString = queryString.slice(1).replace(/q=[^&]+&?|&?render=[^&]+/, '');
    if (queryString !== '') {
      // If there is a '?' in ajax_path, clean url are on and & should be used to add parameters.
      queryString = ((/\?/.test(ajax_path)) ? '&' : '?') + queryString;
    }
  }

  this.element_settings = {
    url: ajax_path + queryString,
    submit: settings,
    setClick: true,
    event: 'click',
    selector: selector,
    progress: { type: 'throbber' }
  };

  this.settings = settings;

  // Add the ajax to exposed forms.
  this.$exposed_form = $('form#views-exposed-form-'+ settings.view_name.replace(/_/g, '-') + '-' + settings.view_display_id.replace(/_/g, '-'));
  this.$exposed_form.once(jQuery.proxy(this.attachExposedFormAjax, this));

  // Add the ajax to pagers.
  this.$view
    // Don't attach to nested views. Doing so would attach multiple behaviors
    // to a given element.
    .filter(jQuery.proxy(this.filterNestedViews, this))
    .once(jQuery.proxy(this.attachPagerAjax, this));
};

Drupal.views.ajaxView.prototype.attachExposedFormAjax = function() {
  var button = $('input[type=submit], button[type=submit], input[type=image]', this.$exposed_form);
  button = button[0];

  this.exposedFormAjax = new Drupal.ajax($(button).attr('id'), button, this.element_settings);
};

Drupal.views.ajaxView.prototype.filterNestedViews= function() {
  // If there is at least one parent with a view class, this view
  // is nested (e.g., an attachment). Bail.
  return !this.$view.parents('.view').size();
};

/**
 * Attach the ajax behavior to each link.
 */
Drupal.views.ajaxView.prototype.attachPagerAjax = function() {
  this.$view.find('ul.pager > li > a, th.views-field a, .attachment .views-summary a')
  .each(jQuery.proxy(this.attachPagerLinkAjax, this));
};

/**
 * Attach the ajax behavior to a singe link.
 */
Drupal.views.ajaxView.prototype.attachPagerLinkAjax = function(id, link) {
  var $link = $(link);
  var viewData = {};
  var href = $link.attr('href');
  // Construct an object using the settings defaults and then overriding
  // with data specific to the link.
  $.extend(
    viewData,
    this.settings,
    Drupal.Views.parseQueryString(href),
    // Extract argument data from the URL.
    Drupal.Views.parseViewArgs(href, this.settings.view_base_path)
  );

  // For anchor tags, these will go to the target of the anchor rather
  // than the usual location.
  $.extend(viewData, Drupal.Views.parseViewArgs(href, this.settings.view_base_path));

  this.element_settings.submit = viewData;
  this.pagerAjax = new Drupal.ajax(false, $link, this.element_settings);
};

Drupal.ajax.prototype.commands.viewsScrollTop = function (ajax, response, status) {
  // Scroll to the top of the view. This will allow users
  // to browse newly loaded content after e.g. clicking a pager
  // link.
  var offset = $(response.selector).offset();
  // We can't guarantee that the scrollable object should be
  // the body, as the view could be embedded in something
  // more complex such as a modal popup. Recurse up the DOM
  // and scroll the first element that has a non-zero top.
  var scrollTarget = response.selector;
  while ($(scrollTarget).scrollTop() == 0 && $(scrollTarget).parent()) {
    scrollTarget = $(scrollTarget).parent();
  }
  // Only scroll upward
  if (offset.top - 10 < $(scrollTarget).scrollTop()) {
    $(scrollTarget).animate({scrollTop: (offset.top - 10)}, 500);
  }
};

})(jQuery);
;
(function ($) {

$(document).ready(function() {

  // Expression to check for absolute internal links.
  var isInternal = new RegExp("^(https?):\/\/" + window.location.host, "i");

  // Attach onclick event to document only and catch clicks on all elements.
  $(document.body).click(function(event) {
    // Catch the closest surrounding link of a clicked element.
    $(event.target).closest("a,area").each(function() {

      var ga = Drupal.settings.googleanalytics;
      // Expression to check for special links like gotwo.module /go/* links.
      var isInternalSpecial = new RegExp("(\/go\/.*)$", "i");
      // Expression to check for download links.
      var isDownload = new RegExp("\\.(" + ga.trackDownloadExtensions + ")$", "i");

      // Is the clicked URL internal?
      if (isInternal.test(this.href)) {
        // Skip 'click' tracking, if custom tracking events are bound.
        if ($(this).is('.colorbox')) {
          // Do nothing here. The custom event will handle all tracking.
        }
        // Is download tracking activated and the file extension configured for download tracking?
        else if (ga.trackDownload && isDownload.test(this.href)) {
          // Download link clicked.
          var extension = isDownload.exec(this.href);
          _gaq.push(["_trackEvent", "Downloads", extension[1].toUpperCase(), this.href.replace(isInternal, '')]);
        }
        else if (isInternalSpecial.test(this.href)) {
          // Keep the internal URL for Google Analytics website overlay intact.
          _gaq.push(["_trackPageview", this.href.replace(isInternal, '')]);
        }
      }
      else {
        if (ga.trackMailto && $(this).is("a[href^='mailto:'],area[href^='mailto:']")) {
          // Mailto link clicked.
          _gaq.push(["_trackEvent", "Mails", "Click", this.href.substring(7)]);
        }
        else if (ga.trackOutbound && this.href.match(/^\w+:\/\//i)) {
          if (ga.trackDomainMode == 2 && isCrossDomain($(this).attr('hostname'), ga.trackCrossDomains)) {
            // Top-level cross domain clicked. document.location is handled by _link internally.
            event.preventDefault();
            _gaq.push(["_link", this.href]);
          }
          else {
            // External link clicked.
            _gaq.push(["_trackEvent", "Outbound links", "Click", this.href]);
          }
        }
      }
    });
  });

  // Colorbox: This event triggers when the transition has completed and the
  // newly loaded content has been revealed.
  $(document).bind("cbox_complete", function() {
    var href = $.colorbox.element().attr("href");
    if (href) {
      _gaq.push(["_trackPageview", href.replace(isInternal, '')]);
    }
  });

});

/**
 * Check whether the hostname is part of the cross domains or not.
 *
 * @param string hostname
 *   The hostname of the clicked URL.
 * @param array crossDomains
 *   All cross domain hostnames as JS array.
 *
 * @return boolean
 */
function isCrossDomain(hostname, crossDomains) {
  /**
   * jQuery < 1.6.3 bug: $.inArray crushes IE6 and Chrome if second argument is
   * `null` or `undefined`, http://bugs.jquery.com/ticket/10076,
   * https://github.com/jquery/jquery/commit/a839af034db2bd934e4d4fa6758a3fed8de74174
   *
   * @todo: Remove/Refactor in D8
   */
  if (!crossDomains) {
    return false;
  }
  else {
    return $.inArray(hostname, crossDomains) > -1 ? true : false;
  }
}

})(jQuery);
;

/**
 * Event handler that listens for flags selected by the user.
 */
jQuery(document).bind('flagGlobalAfterLinkUpdate', function(event, data) {
  var refresh = new viewsFlagRefresh(data.flagName);
  jQuery.each(Drupal.settings.views.ajaxViews, function(index, settings) {
    refresh.ajax(settings);
  });
});

/**
 * Constructor for the viewsFlagRefresh object, sets the name of the flag that
 * was selected.
 * 
 * @param flagName
 *   The name of the flag selected by the user.
 */
function viewsFlagRefresh(flagName) {
  this.flagName = flagName;
}

/**
 * Class method that returns the Views module's AJAX path.
 * 
 * @reutrn
 *   The Views module's AJAX path.
 */
viewsFlagRefresh.ajaxPath = function() {
  var ajaxPath = Drupal.settings.views.ajax_path;
  if (ajaxPath.constructor.toString().indexOf("Array") != -1) {
    ajaxPath = ajaxPath[0];
  }
  return ajaxPath;
}

/**
 * Returns the widget settings associated with the view. Returns false if the
 * view isn't set to refresh on this flag.
 * 
 * @param viewName
 *   The name of the view we are running the check against.
 * @param viewDisplayId
 *   The display ID of the view we are running the check against.
 * @return
 *   A string containing the theme hook used to theme the view as it is being
 *   refreshed, a boolean false if the view should not be refreshed at all.
 */
viewsFlagRefresh.prototype.widgetSettings = function(viewName, viewDisplayId) {
  var settings = Drupal.settings.viewsFlagRefresh.flags;
  for (var flagName in settings) {
    functionName = viewName + '-' + viewDisplayId;
    if (flagName == this.flagName && functionName in settings[flagName]) {
      return settings[flagName][functionName];
    }
  }
  return false;
}

/**
 * Returns a key / value pair to be uses as settings by the ajax methods.
 * 
 * @param view
 *   a jQuery object containing the view.
 * @param settings
 *   The View's AJAX settings.
 * @param theme
 *   The theme object.
 * @return
 *   The AJAX settings.
 */
viewsFlagRefresh.ajaxSettings = function(view, settings, theme) {
  return {
    url: viewsFlagRefresh.ajaxPath(),
    type: 'GET',
    data: settings,
    success: function(response, status) {
      // Handle ajax response.
      jQuery(view).data('viewsFlagRefresh_ajax').success(response, status);

      // Invokes theme hook.
      jQuery(view).filter(function() { return !jQuery(this).parents('.view').size(); }).each(function() {
        theme.target = this;
        theme.hookInvoke('themeHookPost');
      });
    },
    error: function() {
      // Invokes theme hook, handles errors gracefully.
      theme.hookInvoke('themeHookPost');
      Drupal.Views.Ajax.handleErrors(xhr, viewsFlagRefresh.ajaxPath());
    },
    dataType: 'json'
  };
}

/**
 * Refreshes a view via AJAX if it is configured to do so.
 * 
 * @param settings
 *   The view's AJAX settings passed through Drupal.settings.views.ajaxViews.
 */
viewsFlagRefresh.prototype.ajax = function(settings) {
  // Bails if the view shouldn't be refreshed when this flag is selected.
  var widgetSettings = this.widgetSettings(settings.view_name, settings.view_display_id);
  if (!widgetSettings) {
    return;
  }

  // Calculates the selector for the view.
  var view = '.view-dom-id-' + settings.view_dom_id;
  if (!jQuery(view).size()) {
    view = '.view-id-' + settings.view_name + '.view-display-id-' + settings.view_display_id;
  }

  // Locates the view, AJAX refreshes the content.
  jQuery(view).filter(function() { return !jQuery(this).parents('.view').size(); }).each(function() {
    var target = this;

    // create ajax object to handle the response.
    if (jQuery(target).data('viewsFlagRefresh_ajax') == null) {
      // TODO: Find a way to handle ajax commands without creating an ajax object.
      var element_settings = {
        url: viewsFlagRefresh.ajaxPath(),
        submit: {},
        setClick: true,
        event: 'click',
        selector: view,
        progress: { type: 'throbber' }
      };

      jQuery(target).data('viewsFlagRefresh_ajax', new Drupal.ajax(false, view, element_settings));
    }
    
    // Instantiates the theme object, invokes the widget's theme hook.
    var theme = new viewsFlagRefresh.theme(target, widgetSettings);
    theme.hookInvoke('themeHook');
    
    // Gets AJAX settings, either refreshes the view or submits the exposed
    // filter form. This latter refreshes the view and maintains the filters.
    var ajaxSettings = viewsFlagRefresh.ajaxSettings(view, settings, theme);
    var exposedForm = jQuery('form#views-exposed-form-' + settings.view_name.replace(/_/g, '-') + '-' + settings.view_display_id.replace(/_/g, '-'));
    if (exposedForm.size()) {
      setTimeout(function() { jQuery(exposedForm).ajaxSubmit(ajaxSettings); }, theme.timeout);
    }
    else {
      setTimeout(function() { jQuery.ajax(ajaxSettings); }, theme.timeout);
    }
  });
}

/**
 * Contructor for our pseudo theme system class.
 * 
 * @param target
 *   A jQuery object containing the content being refreshed.
 * @param settings
 *   The widget settings.
 */
viewsFlagRefresh.theme = function(target, settings) {
  this.timeout  = 0;
  this.target   = target;
  this.settings = settings;
}

/**
 * Invokes a hook in the theme object.
 * 
 * @param hookType
 *   The hook type being invoked, i.e. 'themeHook', 'themeHookPost'.
 * @return
 *   A boolean flagging whether the hook exists.
 */
viewsFlagRefresh.theme.prototype.hookInvoke = function(hookType) {
  if (hookType in this.settings && this.settings[hookType] in this) {
    this[this.settings[hookType]]();
    return true;
  }
  return false;
}

/**
 * Adds a throbber image to the view content while it is being refreshed.
 */
viewsFlagRefresh.theme.prototype.throbber = function() {
  // Hide the content of the view.
  jQuery(this.target).css('visibility', 'hidden');
  
  // Captures parent, as the view is usually in something such as a block.
  var container = jQuery(this.target).parent();
  
  // Adds our throbber to the middle of the view.
  // NOTE: The throbber image is 32px wide.
  var pos = jQuery(container).position();
  this.throbberElement = jQuery('<img src="' + Drupal.settings.viewsFlagRefresh.imagePath + '/throbber.gif" class="views_flag_refresh-throbber" />')
    .css('left', pos.left + (jQuery(container).outerWidth() / 2) - 16)
    .css('top', pos.top + (jQuery(container).outerHeight() / 2) - 16)
    .insertAfter(this.target);
}

/**
 * Cleans up the throbber image.
 * 
 * @param target
 *   A jQuery object containing the view being refreshed.
 */
viewsFlagRefresh.theme.prototype.throbberPost = function() {
  jQuery(this.throbberElement).remove();
};
